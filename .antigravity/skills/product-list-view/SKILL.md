---
name: 產品列表視圖 (Product List View)
description: 首頁/列表頁面 (home_list.html) 的顯示標準與邏輯。
---

# 產品列表視圖技能 (Product List View Skill)

此技能定義了產品列表（首頁）的視覺風格與行為，包括新增產品的互動對話框。

## 1. UI 結構
-   **佈局**: 採用標準表格佈局 (Standard Table Layout)，而非卡片式設計。
    - 列表排序: 客戶
-   **欄位**:
    1.  **客戶 (Client)**: 文字，靠左對齊。
    2.  **型號規格 (Model Spec)**: 文字，靠左對齊。
    3.  **庫存 (Inv)**: 數字，靠左對齊。顯示 Context 月份的 `actual_i`（實際庫存）；若未設定則顯示 `forecast_i`（預測庫存），建議以顏色區分兩者。
    5.  **動作 (Action)**:  
        -   **對齊**: 靠右對齊 (Align Right)。
        -   **排版**: 水平排列 (Horizontal Flex)，禁止換行 (No Wrap)。
        -   **按鈕**: 
            -   "編輯": 主要樣式 (Primary)，可適當縮小。
            -   "歷史": **幽靈樣式 (Ghost/Text Only)**，灰色文字顯得更輕量，避免與綠色/藍色衝突。
-   **樣式**:
    -   標題背景: 淺藍色 (`var(--secondary-color)`)。
    -   懸停效果: 滑鼠指向行時顯示淺色背景。
    -   邊框: 極簡的水平邊框。

## 2. 控制區域 (Controls)
-   **位置**: 列表上方。
-   **元素**:
    1.  **客戶篩選**: 
        -   **標籤**: 顯示 "客戶" 二字 (Label Visible)，與下拉選單緊密排列，文字中間不可有空格。
        -   **下拉選單**: 資料來源必須讀取完整客戶清單 (`AppState.clients`)。
        -   **樣式**: 標籤與選單水平排列，間距由 CSS Gap 控制。
    2.  **統計資訊**: 文字 "顯示 X 筆，共 Y 筆" (灰色字體)。
    3.  **新增按鈕**: 靠右對齊，使用藍色主色調。
    -   **排版**: 使用 Flexbox `justify-content: space-between` 確保左右平衡。

## 3. 互動行為
-   **篩選**: 切換客戶下拉選單時，必須立即過濾表格行，無需重新載入頁面。
-   **新增**: 點擊 "新增產品" 時，開啟 `<dialog id="dialog-add">`。
-   **編輯**: 點擊行內的 "編輯" 按鈕，跳轉至詳細預測頁面。 使用藍色主色調。
        -   **首次編輯 上個月的資料 實際值帶入預測值**：
            - 更新統計資訊（顯示筆數）
            - 同步儲存到資料庫。
-   **年度歷史視圖**: 點擊行內的 "查詢歷史" 按鈕，跳轉至 年度歷史視圖頁面。 

## 4. 新增產品對話框 (Add Product Dialog)
此對話框用於新增產品項目至列表，具有以下結構與行為：

### 4.1 對話框結構
-   **標題**: "新增產品"
-   **表單欄位**:
    1.  **客戶選擇**: 下拉選單，資料參考 ./data/client.json
        -   **預設值**: 空值（需使用者選擇）
        -   **必選**: 是
    2.  **型號規格**: 下拉選單 資料參考 ./data/product.json
        -   **動態選項**: 根據選擇的客戶，顯示該客戶尚未使用的產品型號列表 
        -   **預設值**: 空值（需使用者選擇）
        -   **必選**: 是
    3.  **實際庫存**: 數字輸入框
        -   **類型**: `type="number"`
        -   **屬性**: 最小值為 0 (`min="0"`)
        -   **預設值**: 0
        -   **必填**: 是

### 4.2 對話框按鈕
-   **取消按鈕**:
    -   **樣式**: 次要按鈕樣式（灰色邊框）
    -   **行為**: 關閉對話框，不儲存任何變更
    -   **位置**: 左側
-   **新增按鈕**:
    -   **樣式**: 主要按鈕樣式（藍色背景）
    -   **行為**: 
        1.  驗證所有必填欄位
        2.  檢查型號規格是否在選定客戶中已存在
        3.  通過驗證後新增產品並更新列表
        4.  關閉對話框
    -   **位置**: 右側

### 4.3 驗證邏輯
-   **客戶選擇**: 必填，未選擇時顯示錯誤訊息
-   **型號規格**: 必填，且不得與選定客戶的現有產品重複
-   **實際庫存**: 必填，必須為非負整數
-   **表單提交前檢查**: 阻止重複新增相同客戶的相同型號

### 4.4 資料處理
-   **新增成功後**:
    1.  將新產品加入產品列表
    2.  更新統計資訊（顯示筆數）
    3.  **不顯示 Alert 視窗** (直接回饋於 UI 或 Toast)。
    4.  同步儲存到資料庫：
        - 寫入  (上個月 Context)。
        - 呼叫 `savePSI` API。

### 4.5 樣式規範
-   **對話框寬度**: 中等寬度（約 500px）
-   **表單佈局**: 垂直堆疊，標籤在上，輸入框在下
-   **錯誤狀態**: 驗證失敗時輸入框顯示紅色邊框，下方顯示紅色錯誤訊息
-   **按鈕對齊**: 右對齊，取消按鈕在前，新增按鈕在後

## 5. 語言規範
-   嚴格遵守 `localization-rules` 技能。

## 6. 資料一致性規則
-   同一客戶不能有重複的型號規格
-   新增產品時，系統應自動檢查並防止重複
-   實際庫存與預測庫存應保持邏輯一致性
-   新增產品時，系統應自動檢查並防止重複
-   所有庫存數值 (actual_i, forecast_i) 必須為非負數 (≥ 0)
